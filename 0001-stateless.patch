From 3f08a7671dd9b3a2c2b27d17790fd1da24995a7b Mon Sep 17 00:00:00 2001
From: Dimitri John Ledkov <dimitri.j.ledkov@intel.com>
Date: Fri, 27 Feb 2015 21:36:30 +0000
Subject: [PATCH 1/5] stateless

Convert sudo to stateless.
---
 pathnames.h.in              | 2 +-
 plugins/sudoers/Makefile.in | 6 ++----
 plugins/sudoers/sudoers.in  | 3 ++-
 3 files changed, 5 insertions(+), 6 deletions(-)

diff --git a/pathnames.h.in b/pathnames.h.in
index 31db3a4..cb3fe47 100644
--- a/pathnames.h.in
+++ b/pathnames.h.in
@@ -66,7 +66,7 @@
  * NOTE: _PATH_SUDOERS is usually overridden by the Makefile.
  */
 #ifndef _PATH_SUDOERS
-# define _PATH_SUDOERS		"/etc/sudoers"
+# define _PATH_SUDOERS		"/usr/share/defaults/sudo/sudoers"
 #endif /* _PATH_SUDOERS */
 
 /*
diff --git a/plugins/sudoers/Makefile.in b/plugins/sudoers/Makefile.in
index 66823d5..9ba930b 100644
--- a/plugins/sudoers/Makefile.in
+++ b/plugins/sudoers/Makefile.in
@@ -121,7 +121,7 @@ shlib_opt = sudoers.opt
 plugindir = @PLUGINDIR@
 
 # Directory in which to install the sudoers file
-sudoersdir = $(sysconfdir)
+sudoersdir = $(datarootdir)/defaults/sudo
 
 # User and group ids the installed files should be "owned" by
 install_uid = 0
@@ -369,9 +369,7 @@ install-plugin: sudoers.la install-dirs
 
 install-sudoers: install-dirs
 	$(INSTALL) -d $(INSTALL_OWNER) -m 0750 $(DESTDIR)$(sudoersdir)/sudoers.d
-	$(INSTALL) $(INSTALL_OWNER) -m $(sudoers_mode) sudoers $(DESTDIR)$(sudoersdir)/sudoers.dist
-	test -r $(DESTDIR)$(sudoersdir)/sudoers || \
-	    cp -p $(DESTDIR)$(sudoersdir)/sudoers.dist $(DESTDIR)$(sudoersdir)/sudoers
+	$(INSTALL) $(INSTALL_OWNER) -m $(sudoers_mode) sudoers $(DESTDIR)$(sudoersdir)/sudoers
 
 uninstall:
 	-$(LIBTOOL) $(LTFLAGS) --mode=uninstall rm -f $(DESTDIR)$(plugindir)/sudoers.la
diff --git a/plugins/sudoers/sudoers.in b/plugins/sudoers/sudoers.in
index 6216dfd..f19d865 100644
--- a/plugins/sudoers/sudoers.in
+++ b/plugins/sudoers/sudoers.in
@@ -79,7 +79,8 @@
 root ALL=(ALL) ALL
 
 ## Uncomment to allow members of group wheel to execute any command
-# %wheel ALL=(ALL) ALL
+%wheel ALL=(ALL) ALL
+%wheelnopw ALL=(ALL) NOPASSWD:ALL
 
 ## Same thing without a password
 # %wheel ALL=(ALL) NOPASSWD: ALL
-- 
2.18.0

